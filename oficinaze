/*SrJose quer modernizar a sua oficina e por enquanto cadastrar os carros que entram para realizar o serviço e o seus 
respectvos donos. Seu Jose mencionou que na maioria das vezes cada cliente possui um carro.
Um carro possui apenas uma marca.
Sr José também quer saber as cores dos carros para ter ideia de qual tinta comprar e ele
informa que um carro pode ter mais de uma cor. Sr José necessita armazenar os telefones dos clientes 
para futuros contatos, mas não quer que eles sejam obrigatórios.*/

-- Foi levantado os requisitos e regras de negócio da Oficina do seu Ze , através do BRMODELO em um modelo conceitual.




CREATE DATABASE OFICINA;
USE OFICINA;

CREATE TABLE CLIENTE(
	IDCLIENTE INT PRIMARY KEY AUTO_INCREMENT,
	NOME VARCHAR(30) NOT NULL,
	SEXO ENUM('M','F') NOT NULL,
	ID_CARRO INT UNIQUE
);

CREATE TABLE TELEFONE(
	IDTELEFONE INT PRIMARY KEY AUTO_INCREMENT,
	TIPO ENUM('CEL','RES','COM') NOT NULL,
	NUMERO VARCHAR(30) NOT NULL,
	ID_CLIENTE INT 
);

CREATE TABLE MARCA(
	IDMARCA INT PRIMARY KEY AUTO_INCREMENT,
	MARCA VARCHAR (30) UNIQUE
);

CREATE TABLE CARRO(
	IDCARRO INT PRIMARY KEY AUTO_INCREMENT,
    MODELO VARCHAR (30) NOT NULL,
    PLACA CHAR(6) NOT NULL UNIQUE,
    ID_MARCA INT
);

CREATE TABLE COR(
	IDCOR INT PRIMARY KEY AUTO_INCREMENT,
	COR VARCHAR(30) UNIQUE
);
// QUANDO SE TEM RELACIONAMENTO N PARA N , PRECISASE CRIAR UMA OUTRA TABELA ONDE A PRIMARY KEY SEJA A UNIÃO DAS DUAS TABELAS
CREATE TABLE CARRO_COR(
	ID_CARRO INT,
	ID_COR INT,
	PRIMARY KEY(ID_CARRO,ID_COR)
);


CREATE TABLE CARRO_MARCA(
	ID_CARRO INT,
	ID_MARCA INT,
	PRIMARY KEY(ID_CARRO,ID_MARCA)
	
);
/* CONSTRAINTS */ /* Depois de definir as tabelas,  se faz os relacionamentos, isso é uma boa pratica e ajuda no Dicionário de Dados*/

ALTER TABLE TELEFONE 
ADD CONSTRAINT FK_TELEFONE_CLIENTE
FOREIGN KEY(ID_CLIENTE)
REFERENCES CLIENTE(IDCLIENTE);


ALTER TABLE CLIENTE
ADD CONSTRAINT FK_CLIENTE_CARRO
FOREIGN KEY(ID_CARRO)
REFERENCES CARRO(IDCARRO);


ALTER TABLE CARRO_MARCA
ADD CONSTRAINT FK_CARRO_MARCA
FOREIGN KEY(ID_CARRO)
REFERENCES CARRO(IDCARRO);


ALTER TABLE CARRO_MARCA
ADD CONSTRAINT FK_CARRO_MARCA_
FOREIGN KEY(ID_MARCA)
REFERENCES MARCA(IDMARCA);


ALTER TABLE CARRO_COR
ADD CONSTRAINT FK_CARRO_COR
FOREIGN KEY(ID_CARRO)
REFERENCES CARRO(IDCARRO);


ALTER TABLE CARRO_COR
ADD CONSTRAINT FK_CARRO_COR_
FOREIGN KEY(ID_COR)
REFERENCES COR(IDCOR);




-- INSERINDO DADOS --



INSERT INTO CLIENTE VALUES (NULL,'Leonardo Scigliano','M',NULL);
INSERT INTO CLIENTE VALUES (NULL,'Rodrigo Garcia','M',NULL);
INSERT INTO CLIENTE VALUES (NULL,'Ricardo Franco','M',NULL);
INSERT INTO CLIENTE VALUES (NULL,'Thiago Kruster','M',NULL);
INSERT INTO CLIENTE VALUES (NULL,'Josiel Augusto','M',NULL);
INSERT INTO CLIENTE VALUES (NULL,'Joao Augusto','M',NULL);
INSERT INTO CLIENTE VALUES (NULL,'Maria das Graças','F',NULL);
INSERT INTO CLIENTE VALUES (NULL,'Julio Rodrigues','M',NULL);
INSERT INTO CLIENTE VALUES (NULL,'Santo Millher','M',NULL);
INSERT INTO CLIENTE VALUES (NULL,'Fatima Aparecida','F',NULL);
INSERT INTO CLIENTE VALUES (NULL,'Francisco Coimbra','M',NULL;



INSERT INTO CARRO VALUES (NULL,'A25','000ABC',NULL);
INSERT INTO CARRO VALUES (NULL,'A25','183ABC',NULL);
INSERT INTO CARRO VALUES (NULL,'B55','193ABC',NULL);
INSERT INTO CARRO VALUES (NULL,'Z52','103ABC',NULL);
INSERT INTO CARRO VALUES (NULL,'K25','143ABC',NULL);
INSERT INTO CARRO VALUES (NULL,'N98','VWR34',NULL);
INSERT INTO CARRO VALUES (NULL,'A25','CAR93',NULL);
INSERT INTO CARRO VALUES (NULL,'B55','VUICC',NULL);
INSERT INTO CARRO VALUES (NULL,'B55','187AC',NULL);
INSERT INTO CARRO VALUES (NULL,'B25','BUV12',NULL);
INSERT INTO CARRO VALUES (NULL,'S10','VWZ151',NULL);
INSERT INTO CARRO VALUES (NULL, 'HB20','TRE23',NULL);


INSERT INTO MARCA VALUES (NULL,'Fiat');
INSERT INTO MARCA VALUES (NULL,'Tesla');
INSERT INTO MARCA VALUES (NULL,'Toyota');
INSERT INTO MARCA VALUES (NULL,'Ferrari');

INSERT INTO COR VALUES(NULL,'AZUL');
INSERT INTO COR VALUES(NULL,'AMARELO');
INSERT INTO COR VALUES(NULL,'ROSA');
INSERT INTO COR VALUES(NULL,'PRETO');
INSERT INTO COR VALUES(NULL,'PRATA');


INSERT INTO CARRO_MARCA VALUES (1,1);
INSERT INTO CARRO_MARCA VALUES (2,1);
INSERT INTO CARRO_MARCA VALUES (3,2);
INSERT INTO CARRO_MARCA VALUES (4,4);
INSERT INTO CARRO_MARCA VALUES (5,3);
INSERT INTO CARRO_MARCA VALUES (6,3);
INSERT INTO CARRO_MARCA VALUES (7,4);
INSERT INTO CARRO_MARCA VALUES (8,1);
INSERT INTO CARRO_MARCA VALUES (9,4);
INSERT INTO CARRO_MARCA VALUES (10,3);
INSERT INTO CARRO_MARCA VALUES (11,2);


INSERT INTO CARRO_COR VALUES(1,1);
INSERT INTO CARRO_COR VALUES(1,4);
INSERT INTO CARRO_COR VALUES(2,2);
INSERT INTO CARRO_COR VALUES(3,3);
INSERT INTO CARRO_COR VALUES(3,4);
INSERT INTO CARRO_COR VALUES(4,5);
INSERT INTO CARRO_COR VALUES(4,2);
INSERT INTO CARRO_COR VALUES(5,2);
INSERT INTO CARRO_COR VALUES(6,3);
INSERT INTO CARRO_COR VALUES(7,1);
INSERT INTO CARRO_COR VALUES(8,1);
INSERT INTO CARRO_COR VALUES(9,1);
INSERT INTO CARRO_COR VALUES(10,1);
INSERT INTO CARRO_COR VALUES(10,3);
INSERT INTO CARRO_COR VALUES(11,4)


INSERT INTO TELEFONE VALUES (NULL,'CEL',54998787487,NULL);
INSERT INTO TELEFONE VALUES (NULL,'CEL',54918787487,NULL);
INSERT INTO TELEFONE VALUES (NULL,'COM',54518787487,NULL);
INSERT INTO TELEFONE VALUES (NULL,'CEL',54953787487,NULL);
INSERT INTO TELEFONE VALUES (NULL,'RES',54945877487,NULL);
INSERT INTO TELEFONE VALUES (NULL,'CEL',5490014487,NULL);
INSERT INTO TELEFONE VALUES (NULL,'COM',5401010587,NULL);
INSERT INTO TELEFONE VALUES (NULL,'CEL',54990158747,NULL);
INSERT INTO TELEFONE VALUES (NULL,'CEL',5498012017,NULL);
INSERT INTO TELEFONE VALUES (NULL,'CEL',54999998987,NULL);

-- *FAZENDO UPDATE DA TABELA TELEFONE, NA VERDADE  FAZENDO ASSOCIAÇÃO DE TABELAS TELEFONE COM CLIENTE.

UPDATE TELEFONE SET ID_CLIENTE = 1
WHERE IDTELEFONE = 1;

UPDATE TELEFONE SET ID_CLIENTE = 2
WHERE IDTELEFONE = 2;

UPDATE TELEFONE SET ID_CLIENTE = 3
WHERE IDTELEFONE = 3;

UPDATE TELEFONE SET ID_CLIENTE = 4
WHERE IDTELEFONE = 4;

UPDATE TELEFONE SET ID_CLIENTE  = 5
WHERE IDTELEFONE = 5;

UPDATE TELEFONE SET ID_CLIENTE = 6
WHERE IDTELEFONE = 6;

UPDATE TELEFONE SET ID_CLIENTE = 7
WHERE IDTELEFONE = 7;

UPDATE TELEFONE SET ID_CLIENTE = 8
WHERE IDTELEFONE = 8;

UPDATE TELEFONE SET ID_CLIENTE = 9
WHERE IDTELEFONE = 10;

UPDATE TELEFONE SET ID_CLIENTE = 10
WHERE IDTELEFONE = 9;


------------ FAZENDO A ASSOCIAÇÃO DA TABELA CARRO COM CLIENTE, INFORMANDO PARA QUAL CARRO PERTENTE A QUAL CLIENTE


UPDATE CLIENTE SET  ID_CARRO = 1
WHERE IDCLIENTE  = 1;

UPDATE CLIENTE
SET  ID_CARRO = 2
WHERE IDCLIENTE  = 2;

UPDATE CLIENTE
SET  ID_CARRO = 3
WHERE IDCLIENTE  = 3;

UPDATE CLIENTE
SET  ID_CARRO = 4
WHERE IDCLIENTE  = 4;

UPDATE CLIENTE
SET  ID_CARRO = 5
WHERE IDCLIENTE  = 5;

UPDATE CLIENTE
SET  ID_CARRO = 6
WHERE IDCLIENTE  = 6;

UPDATE CLIENTE
SET  ID_CARRO = 7
WHERE IDCLIENTE  = 6;

UPDATE CLIENTE
SET  ID_CARRO = 8
WHERE IDCLIENTE  = 7;

UPDATE CLIENTE
SET  ID_CARRO = 9
WHERE IDCLIENTE  = 8;

UPDATE CLIENTE
SET  ID_CARRO = 10
WHERE IDCLIENTE  = 9;


UPDATE CLIENTE
SET  ID_CARRO = 11
WHERE IDCLIENTE  = 10;

UPDATE CLIENTE
SET  ID_CARRO = 12
WHERE IDCLIENTE  = 11;

/* Seu ze se esqueceu de qual cor Leonardo pediu para pintar então solicitou que fosse 
informado qual  tinta comprar e se é mais do que uma. Ele também precisa saber se uma lata pequena consegue pintar todo o seu carro,
mas esqueceu qual era o modelo do seu carro, solicitou então que fosse informado também qual o modelo do carro */


-- LOCALIZANDO O NOME CORRETO DO CLIENTE E A FK DO CARRO.
SELECT * FROM CLIENTE
WHERE NOME LIKE 'LEONA%';


-- AGORA É PRECISO JUNTAR AS TABELAS PARA LOCALIZAR O MODELO DO CARRO PARA SEU ZE

SELECT CLI.NOME,CAR.MODELO,CAR.PLACA,CAR.IDCARRO
FROM CLIENTE CLI
JOIN CARRO CAR
ON IDCARRO = ID_CARRO
WHERE ID_CARRO = 1;

-- INFORMANDO PARA SEU ZE  A QUANTIDADE DE CORES QUE O CARRO DE LEONARDO TEM E QUAIS CORES SÃO,NESSE CASO as cores são AZUL E PRETO.


SELECT CR.*,C.* FROM CARRO_COR CR
JOIN COR C
ON IDCOR = ID_COR
WHERE ID_CARRO = 1;


/* SEU Ze se lembro que um determinado cliente ficou de lhe pagar o valor da TINTA
que comprou anteriormente, mas esqueceu o nome do cliente, ele só se lembra que 
a pessoa tem o sobrenome que termina com "imbra"
Solicitou então que fosse feito buscas de quantas pessoas tem o sobrenome com essas letras */


-- Com essa busca foi localizado o cliente francisco coimbra
SELECT *
FROM CLIENTE
WHERE NOME LIKE '%IMBRA%';

--  dois meses depois SEU ZE Esqueceu novamente o modelo do carro de um cliente, foi intão criado uma View para economizar tempo.

CREATE VIEW VW_Modelo_carro as
SELECT CLI.NOME,CAR.MODELO,CAR.PLACA,CAR.IDCARRO
FROM CLIENTE CLI
JOIN CARRO CAR
ON IDCARRO = ID_CARRO;


-- Agora ficou fácil quando seu ze precisar consultar o modelo do carro de algum cliente.
SELECT * FROM VW_MODELO_CARRO
WHERE IDCARRO = 3;
